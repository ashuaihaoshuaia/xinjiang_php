(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-144fef9a"],{a4b3:function(e,t,s){"use strict";s("f3df")},f0c3:function(e,t,s){"use strict";s.r(t);var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"message-main-content"},[s("div",{staticClass:"message-mainlist-content"},[s("div",[s("Button",{attrs:{size:"large",long:"",type:"text"},on:{click:function(t){return e.setCurrentMesType("unread")}}},[s("div",{staticClass:"mes-wrap"},[s("transition",{attrs:{name:"mes-current-type-btn"}},[s("Icon",{directives:[{name:"show",rawName:"v-show",value:"unread"==e.currentMesType,expression:"currentMesType == 'unread'"}],attrs:{type:"md-checkmark"}})],1),s("span",{staticClass:"mes-type-btn-text"},[e._v("未读消息")]),s("Badge",{staticClass:"message-count-badge-outer",attrs:{"class-name":"message-count-badge-red",count:e.unreadCount}})],1)])],1),s("div",[s("Button",{attrs:{size:"large",long:"",type:"text"},on:{click:function(t){return e.setCurrentMesType("hasread")}}},[s("div",{staticClass:"mes-wrap"},[s("transition",{attrs:{name:"mes-current-type-btn"}},[s("Icon",{directives:[{name:"show",rawName:"v-show",value:"hasread"==e.currentMesType,expression:"currentMesType == 'hasread'"}],attrs:{type:"md-checkmark"}})],1),s("span",{staticClass:"mes-type-btn-text"},[e._v("已读消息")]),s("Badge",{staticClass:"message-count-badge-outer",attrs:{"class-name":"message-count-badge",count:e.hasreadCount}})],1)])],1)]),s("div",{staticClass:"message-content-content"},[s("transition",{attrs:{name:"view-message"}},[e.showMesList?s("div",{staticClass:"message-title-list-content"},[s("Table",{ref:"messageList",attrs:{loading:e.loading,columns:e.columns,data:e.mesList}}),s("div",{staticClass:"message-page"},["unread"==e.currentMesType?s("Poptip",{attrs:{confirm:"",transfer:"",title:"确定标记所有消息为已读？"},on:{"on-ok":e.readAll}},[s("Button",{attrs:{icon:"md-notifications-off",disabled:e.unreadCount<=0}},[e._v("全部标记已读")])],1):e._e(),"hasread"==e.currentMesType?s("Poptip",{attrs:{confirm:"",transfer:"",title:"确定彻底删除所有已读消息？"},on:{"on-ok":e.deleteAll}},[s("Button",{attrs:{icon:"md-trash",disabled:e.hasreadCount<=0}},[e._v("全部彻底删除")])],1):e._e(),s("Page",{staticClass:"page-fix",attrs:{current:e.params.pageNumber,total:e.total,"page-size":e.params.pageSize,"page-size-opts":[5,10],size:"small","show-total":"","show-elevator":"","show-sizer":""},on:{"on-change":e.changePage,"on-page-size-change":e.changePageSize}})],1)],1):e._e()]),s("transition",{attrs:{name:"back-message-list"}},[e.showMesList?e._e():s("div",{staticClass:"message-view-content-content"},[s("div",{staticClass:"message-content-top-bar"},[s("span",{staticClass:"mes-back-btn-content"},[s("Button",{attrs:{type:"text"},on:{click:e.backList}},[s("Icon",{attrs:{type:"ios-arrow-back"}}),e._v("  返回 ")],1)],1),s("h3",{staticClass:"mes-title"},[e._v(e._s(e.mes.title))])]),s("p",{staticClass:"mes-time-content"},[s("Icon",{attrs:{type:"android-time"}}),e._v("   "+e._s(e.mes.time)+" ")],1),s("div",{staticClass:"message-content-body"},[s("p",{staticClass:"message-content",domProps:{innerHTML:e._s(e.mes.content)}},[e._v(" "+e._s(e.mes.content)+" ")])])])])],1)])},a=[],i=s("be65"),r=s.n(i),o=s("365c"),c={name:"message_index",data:function(){var e=this,t=function(t,s){return t("Button",{props:{icon:"md-eye-off",size:"small"},on:{click:function(){var t=s.row;for(var n in t)null==t[n]&&(t[n]="");var a=JSON.stringify(t),i=JSON.parse(a);i.status=1,e.loading=!0,Object(o["N"])(i).then((function(t){e.loading=!1,t.success&&(e.$Message.success("操作成功"),e.getCount(),e.refreshMessage())}))}}},"标为已读")},s=function(t,s){return t("Button",{props:{icon:"md-trash",size:"small"},on:{click:function(){var t=s.row;e.loading=!0,Object(o["x"])({ids:t.id}).then((function(t){e.loading=!1,t.success&&(e.$Message.success("操作成功"),e.getCount(),e.refreshMessage())}))}}},"删除")};return{loading:!0,params:{userId:JSON.parse(r.a.get("userInfo")).id,status:0,pageNumber:1,pageSize:10,sort:"createTime",order:"desc"},total:0,mesList:[],currentMesType:"unread",showMesList:!0,unreadCount:0,hasreadCount:0,mes:{title:"",time:"",content:""},columns:[{type:"index",width:60,align:"center"},{title:" ",key:"title",align:"left",ellipsis:!0,render:function(t,s){return t("span",[t("a",{style:{margin:"0 30px 0 0"},on:{click:function(){e.getContent(s.row)}}},"【"+s.row.type+"】 "+s.row.title)])}},{title:" ",key:"time",align:"center",width:190,render:function(e,t){return e("span",[e("Icon",{props:{type:"md-time",size:16},style:{margin:"0 5px 3px 0"}}),e("span",t.row.createTime)])}},{title:" ",key:"asread",align:"center",width:210,render:function(n,a){return"unread"==e.currentMesType?n("div",[t(n,a)]):"hasread"==e.currentMesType?n("div",[s(n,a)]):void 0}}]}},methods:{changePage:function(e){this.params.pageNumber=e,this.refreshMessage()},changePageSize:function(e){this.params.pageSize=e,this.refreshMessage()},refreshMessage:function(){var e=this,t=0,s=this.currentMesType;"unread"==s?t=0:"hasread"==s&&(t=1),this.params.status=t,this.loading=!0,Object(o["rb"])(this.params).then((function(t){e.loading=!1,t.success&&(e.mesList=t.result.content,e.total=t.result.totalElements,"unread"==s?e.unreadCount=e.total:"hasread"==s&&(e.hasreadCount=e.total))}))},initMessage:function(){var e=this.$route.query;e.content&&this.getContent(e.content),this.getCount(!0)},getCount:function(e){this.getUnreadCount(e),this.getReadCount()},getUnreadCount:function(e){var t=this;this.params.status=0,Object(o["rb"])(this.params).then((function(s){s.success&&(e&&(t.loading=!1,t.mesList=s.result.content),t.unreadCount=s.result.totalElements,t.$store.commit("setMessageCount",t.unreadCount))}))},getReadCount:function(){var e=this;this.params.status=1,Object(o["rb"])(this.params).then((function(t){t.success&&(e.hasreadCount=t.result.totalElements)}))},deleteMessage:function(e){var t=this;Object(o["x"])({ids:e}).then((function(e){e.success&&t.$Message.success("删除成功")}))},setCurrentMesType:function(e){this.currentMesType!=e&&(this.showMesList=!0),this.currentMesType=e,this.params.pageNumber=1,this.refreshMessage()},getContent:function(e){var t=this;if(this.showMesList=!1,this.mes.title=e.title,this.mes.time=e.createTime,this.mes.content=e.content,0==e.status){for(var s in e)null==e[s]&&(e[s]="");var n=JSON.stringify(e),a=JSON.parse(n);a.status=1,Object(o["N"])(a).then((function(e){e.success&&(t.getCount(),t.refreshMessage())}))}},readAll:function(){var e=this;Object(o["j"])(0).then((function(t){t.success&&(e.getCount(),e.refreshMessage())}))},deleteAll:function(){var e=this;Object(o["j"])(1).then((function(t){t.success&&(e.getCount(),e.refreshMessage())}))},backList:function(){this.showMesList=!0,this.$router.push({name:"message_index"})}},mounted:function(){this.initMessage()},watch:{$route:function(e,t){if("message_index"==e.name){var s=this.$route.query;if(s.content)return void this.initMessage();this.refreshMessage()}}}},u=c,l=(s("a4b3"),s("2877")),d=Object(l["a"])(u,n,a,!1,null,null,null);t["default"]=d.exports},f3df:function(e,t,s){}}]);